{% extends "base.html" %}
{% load static %}
{% block title %}Merchant Dashboard{% endblock %}
{% block navbar_title %}TableTap - Merchant{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/merchant_style.css' %}">
{% endblock %}

{% block content %}
<!-- Restaurant Header -->
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h2 class="mb-1">{{ restaurant.name }}</h2>
        <p class="text-muted mb-0">
          <i class="bi bi-person-badge"></i> Owner: {{ user.username }}
          {% if restaurant.description %}
          <br>
          <i class="bi bi-info-circle"></i> {{ restaurant.description }}
          {% endif %}
        </p>
      </div>
      <div class="col-md-4 text-end">
        <div class="badge bg-primary fs-6 px-3 py-2">
          <i class="bi bi-table"></i> {{ restaurant.num_tables }} Tables
        </div>
      </div>
    </div>
  </div>
</div>

<h3 class="text-center fw-bold mb-4">Dashboard</h3>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab">Current Orders</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="menu-tab" data-bs-toggle="tab" data-bs-target="#menu" type="button" role="tab">Menu Management</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tables-tab" data-bs-toggle="tab" data-bs-target="#tables" type="button" role="tab">Table Configuration</button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content p-3 border border-top-0" id="dashboardTabContent">

    <!-- Current Orders -->
    <div class="tab-pane fade show active" id="orders" role="tabpanel">
      <h4>Current PENDING Orders</h4>
      {% if orders %}
        <table class="table table-striped mt-3">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Table</th>
              <th>Time</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr>
              <td>{{ order.id }}</td>
              <td>{{ order.table.table_number }}</td>
              <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
              <td>
                <a href="{% url 'order-detail' order.id %}" class="btn btn-primary btn-sm">View</a>
                <a href="{% url 'generate-qr-code' order.table.id %}" class="btn btn-outline-success btn-sm">QR Code</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted">No current orders.</p>
      {% endif %}
    </div>

    <!-- Menu Management -->
    <div class="tab-pane fade" id="menu" role="tabpanel">
      <h4>Menu Categories</h4>
      <form method="post" action="{% url 'add-category' %}" class="row g-3 mb-3">
        {% csrf_token %}
        <div class="col-md-6">
          <input type="text" name="category_name" class="form-control" placeholder="New Category Name" required>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-success">Add Category</button>
        </div>
      </form>

      <h5 class="mt-4">Add Menu Item</h5>
      <form method="post" action="{% url 'add-menu-item' %}" class="row g-3">
        {% csrf_token %}
        <div class="col-md-4">
          <input type="text" name="item_name" class="form-control" placeholder="Item Name" required>
        </div>
        <div class="col-md-2">
          <input type="number" step="0.01" name="item_price" class="form-control" placeholder="Price" required>
        </div>
        <div class="col-md-3">
          <input type="text" name="item_description" class="form-control" placeholder="Description">
        </div>
        <div class="col-md-3">
          <select name="category_id" class="form-select" required>
            <option value="" selected>Choose Category</option>
            {% for category in categories %}
            <option value="{{ category.id }}">{{ category.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-primary">Add Item</button>
        </div>
      </form>
    </div>

    <!-- Table Configuration -->
    <div class="tab-pane fade" id="tables" role="tabpanel">
        <h4>Configure Number of Tables</h4>
        <p class="text-muted">Enter the number of tables for your restaurant. Existing tables will be kept.</p>
        <form method="post" class="row g-3 align-items-center mb-3">
            {% csrf_token %}
            <div class="col-auto">
                <label for="tableCount" class="col-form-label">Total Tables:</label>
            </div>
            <div class="col-auto">
                <input type="number" name="table_count" id="tableCount" class="form-control" value="10" min="1">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>

</div>

{% endblock %}